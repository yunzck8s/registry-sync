# Registry Sync

<div align="center">

![Version](https://img.shields.io/badge/version-0.0.1-blue.svg)
![Go Version](https://img.shields.io/badge/Go-1.25%2B-00ADD8?logo=go)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Docker](https://img.shields.io/badge/docker-ready-blue?logo=docker)

**ä¼ä¸šçº§ Docker/Harbor é•œåƒåŒæ­¥ç®¡ç†å¹³å°**

è½»æ¾å®ç°è·¨ Registry é•œåƒåŒæ­¥ï¼Œæ”¯æŒå¤šæ¶æ„é•œåƒã€å®šæ—¶ä»»åŠ¡ã€å®æ—¶é€šçŸ¥

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æ–¹å¼) â€¢ [ç”¨æˆ·æ‰‹å†Œ](#-ç”¨æˆ·æ‰‹å†Œ) â€¢ [API æ–‡æ¡£](#-api-æ–‡æ¡£)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒèƒ½åŠ›

- **é•œåƒåŒæ­¥** - åŸºäº Docker Registry V2 APIï¼Œç›´æ¥æ“ä½œ Blob å’Œ Manifestï¼Œæ— éœ€ Docker Daemon
- **å¤šæ¶æ„æ”¯æŒ** - è‡ªåŠ¨è¯†åˆ«å¹¶åŒæ­¥ Manifest Listï¼ˆmulti-archï¼‰ï¼Œæ”¯æŒ amd64/arm64/arm ç­‰
- **æ™ºèƒ½è¿‡æ»¤** - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… Tagã€é»‘åå•è¿‡æ»¤ã€ä¿ç•™æœ€æ–° N ä¸ªç‰ˆæœ¬
- **å®šæ—¶ä»»åŠ¡** - å‹å¥½çš„ Cron è¡¨è¾¾å¼é…ç½®ï¼Œæ”¯æŒé¢„è®¾ï¼ˆæ¯å¤©ã€æ¯å‘¨ã€æ¯æœˆç­‰ï¼‰
- **å®æ—¶é€šçŸ¥** - ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰é€šçŸ¥ï¼Œä»»åŠ¡æ‰§è¡Œç»“æœåŠæ—¶æ¨é€
- **è¿›åº¦è¿½è¸ª** - WebSocket å®æ—¶æ¨é€åŒæ­¥è¿›åº¦å’Œæ—¥å¿—
- **Web ç®¡ç†** - ç°ä»£åŒ– React UIï¼Œæ“ä½œç®€å•ç›´è§‚

### ğŸ¯ ä¼ä¸šçº§ç‰¹æ€§

- **æ•°æ®æŒä¹…åŒ–** - SQLite å­˜å‚¨ä»»åŠ¡é…ç½®å’Œæ‰§è¡Œå†å²
- **å®¹å™¨åŒ–éƒ¨ç½²** - æä¾› Docker é•œåƒå’Œ Docker Compose é…ç½®
- **Kubernetes æ”¯æŒ** - å®Œæ•´çš„ K8s éƒ¨ç½² YAML
- **å¥åº·æ£€æŸ¥** - å†…ç½®å¥åº·æ£€æŸ¥æ¥å£ï¼Œä¾¿äºç›‘æ§
- **å¹¶å‘æ§åˆ¶** - æ”¯æŒå¹¶å‘åŒæ­¥å¤šä¸ª Blobï¼Œæå‡æ•ˆç‡
- **å¢é‡åŒæ­¥** - åªä¼ è¾“æ–°å¢æˆ–å˜æ›´çš„ Blobï¼ŒèŠ‚çœå¸¦å®½

---

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# 1. ä¸‹è½½ docker-compose.yml
curl -O https://raw.githubusercontent.com/yunzck8s/registry-sync/main/docker-compose.yml

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. è®¿é—® Web ç•Œé¢
open http://localhost:8080
```

### æ–¹å¼äºŒï¼šDocker å‘½ä»¤

```bash
# æ‹‰å–é•œåƒ
docker pull zunshen/registry-sync:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name registry-sync \
  -p 8080:8080 \
  -v ./data:/app/data \
  -e TZ=Asia/Shanghai \
  zunshen/registry-sync:latest

# è®¿é—® Web ç•Œé¢
open http://localhost:8080
```

### æ–¹å¼ä¸‰ï¼šKubernetes

```bash
# éƒ¨ç½²åˆ° K8s é›†ç¾¤
kubectl apply -k https://github.com/yunzck8s/registry-sync/k8s

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
kubectl get pods -n registry-sync
```

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### ä»ªè¡¨ç›˜
- å®æ—¶ç»Ÿè®¡ï¼šä»»åŠ¡æ•°ã€æ‰§è¡Œè®°å½•ã€æˆåŠŸ/å¤±è´¥ç‡
- æœ€è¿‘æ‰§è¡Œè®°å½•åˆ—è¡¨
- å¿«é€Ÿæ“ä½œå…¥å£

### Registry ç®¡ç†
- æ·»åŠ /ç¼–è¾‘ Docker Hubã€Harborã€ACR ç­‰ Registry
- æµ‹è¯•è¿æ¥åŠŸèƒ½
- æµè§ˆé¡¹ç›®å’Œä»“åº“åˆ—è¡¨

### ä»»åŠ¡ç®¡ç†
- å¯è§†åŒ–åˆ›å»ºåŒæ­¥ä»»åŠ¡
- æº/ç›®æ ‡ Registry é€‰æ‹©
- Tag è¿‡æ»¤è§„åˆ™é…ç½®ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰
- æ¶æ„é€‰æ‹©ï¼ˆamd64/arm64ï¼‰
- Cron å®šæ—¶ä»»åŠ¡è®¾ç½®ï¼ˆé¢„è®¾ + è‡ªå®šä¹‰ï¼‰
- ç«‹å³è¿è¡Œ/åœæ­¢/ç¼–è¾‘/åˆ é™¤

### æ‰§è¡Œå†å²
- æŸ¥çœ‹æ‰€æœ‰æ‰§è¡Œè®°å½•
- å®æ—¶è¿›åº¦å±•ç¤ºï¼ˆè¿›åº¦æ¡ + ç™¾åˆ†æ¯”ï¼‰
- è¯¦ç»†æ—¥å¿—æŸ¥çœ‹
- æ‰§è¡Œæ—¶é—´å’Œè€—æ—¶ç»Ÿè®¡
- çŠ¶æ€è¿‡æ»¤å’Œæœç´¢

### é€šçŸ¥ç®¡ç†
- ä¼ä¸šå¾®ä¿¡/é’‰é’‰ Webhook é…ç½®
- é€šçŸ¥æ¡ä»¶è®¾ç½®ï¼ˆå…¨éƒ¨/ä»…å¤±è´¥ï¼‰
- æµ‹è¯•å‘é€åŠŸèƒ½
- å¤šæ¸ é“ç®¡ç†

---

## ğŸš€ éƒ¨ç½²æ–¹å¼

### Docker Compose éƒ¨ç½²

**docker-compose.yml**
```yaml
version: '3.8'
services:
  registry-sync:
    image: zunshen/registry-sync:latest
    container_name: registry-sync
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    environment:
      - TZ=Asia/Shanghai
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:8080/api/v1/health"]
      interval: 30s
      timeout: 3s
      retries: 3
```

```bash
docker-compose up -d
```

### Kubernetes éƒ¨ç½²

**å®Œæ•´éƒ¨ç½²é…ç½®**
```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/yunzck8s/registry-sync.git
cd registry-sync/k8s

# 2. ä¿®æ”¹é…ç½®ï¼ˆå¯é€‰ï¼‰
# - ä¿®æ”¹ ingress.yaml ä¸­çš„åŸŸå
# - ä¿®æ”¹ pvc.yaml ä¸­çš„å­˜å‚¨å¤§å°

# 3. éƒ¨ç½²
kubectl apply -k .

# 4. æŸ¥çœ‹çŠ¶æ€
kubectl get all -n registry-sync

# 5. è®¿é—®æœåŠ¡
# - ClusterIP: kubectl port-forward -n registry-sync svc/registry-sync 8080:8080
# - Ingress: https://your-domain.com
```

**K8s èµ„æºè¯´æ˜**
- **Namespace**: registry-syncï¼ˆç‹¬ç«‹å‘½åç©ºé—´ï¼‰
- **Deployment**: å•å‰¯æœ¬éƒ¨ç½²
- **PVC**: 10Gi æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¯è°ƒæ•´ï¼‰
- **Service**: ClusterIP ç±»å‹
- **Ingress**: å¯é€‰ï¼Œéœ€é…ç½®åŸŸåå’Œ TLS

**èµ„æºé™åˆ¶**
```yaml
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"
    cpu: "500m"
```

### ä»æºç æ„å»º

**å‰ç½®è¦æ±‚**
- Go 1.25+
- Node.js 18+
- npm æˆ– yarn

**æ­¥éª¤**
```bash
# 1. å…‹éš†ä»£ç 
git clone https://github.com/yunzck8s/registry-sync.git
cd registry-sync

# 2. æ„å»ºå‰ç«¯
cd web
npm install
npm run build

# 3. æ„å»ºåç«¯
cd ..
go build -o registry-sync-server ./cmd/server

# 4. è¿è¡Œ
./registry-sync-server --port 8080 --db data/registry-sync.db
```

**Docker é•œåƒæ„å»º**
```bash
# æ„å»ºé•œåƒ
docker build -t registry-sync:latest .

# è¿è¡Œ
docker run -d -p 8080:8080 -v ./data:/app/data registry-sync:latest
```

---

## ğŸ“– ç”¨æˆ·æ‰‹å†Œ

### 1. æ·»åŠ  Registry

1. ç‚¹å‡»å·¦ä¾§èœå• **Registry ç®¡ç†**
2. ç‚¹å‡»å³ä¸Šè§’ **æ·»åŠ  Registry** æŒ‰é’®
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   - **åç§°**ï¼šè‡ªå®šä¹‰åç§°ï¼ˆå¦‚ï¼šDocker Hubã€Harbor ç”Ÿäº§ï¼‰
   - **URL**ï¼šRegistry åœ°å€
     - Docker Hub: `https://registry-1.docker.io`
     - Harbor: `https://harbor.example.com`
     - é˜¿é‡Œäº‘ ACR: `https://registry.cn-hangzhou.aliyuncs.com`
   - **ç”¨æˆ·å/å¯†ç **ï¼šè®¤è¯å‡­æ®
   - **å¯ç”¨**ï¼šæ˜¯å¦ç«‹å³å¯ç”¨
4. ç‚¹å‡» **æµ‹è¯•è¿æ¥** éªŒè¯é…ç½®
5. ç‚¹å‡» **ç¡®å®š** ä¿å­˜

**æç¤º**ï¼š
- å¯†ç å­—æ®µä¸ä¼šå›æ˜¾ï¼Œé‡æ–°ç¼–è¾‘æ—¶ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹
- Docker Hub éœ€è¦ä½¿ç”¨ä¸ªäºº Token è€Œéå¯†ç 

### 2. åˆ›å»ºåŒæ­¥ä»»åŠ¡

1. ç‚¹å‡»å·¦ä¾§èœå• **ä»»åŠ¡ç®¡ç†**
2. ç‚¹å‡»å³ä¸Šè§’ **åˆ›å»ºä»»åŠ¡** æŒ‰é’®
3. é…ç½®ä»»åŠ¡ä¿¡æ¯ï¼š

**åŸºç¡€é…ç½®**
- **ä»»åŠ¡åç§°**ï¼šæè¿°æ€§åç§°ï¼ˆå¦‚ï¼šåŒæ­¥ Nginx åˆ°ç”Ÿäº§ï¼‰
- **å¯ç”¨**ï¼šæ˜¯å¦ç«‹å³å¯ç”¨ä»»åŠ¡

**æºé…ç½®**
- **æº Registry**ï¼šé€‰æ‹©æºé•œåƒä»“åº“
- **é¡¹ç›®**ï¼šé€‰æ‹©é¡¹ç›®ï¼ˆHarborï¼‰æˆ–å‘½åç©ºé—´ï¼ˆDocker Hubï¼‰
- **ä»“åº“**ï¼š
  - ç•™ç©ºï¼šåŒæ­¥æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»“åº“
  - æŒ‡å®šï¼šåªåŒæ­¥æŒ‡å®šä»“åº“

**ç›®æ ‡é…ç½®**
- **ç›®æ ‡ Registry**ï¼šé€‰æ‹©ç›®æ ‡é•œåƒä»“åº“
- **é¡¹ç›®**ï¼šé€‰æ‹©æˆ–è¾“å…¥æ–°é¡¹ç›®å
- **ä»“åº“**ï¼š
  - ç•™ç©ºï¼šè‡ªåŠ¨ä½¿ç”¨æºä»“åº“å
  - æŒ‡å®šï¼šä½¿ç”¨è‡ªå®šä¹‰ä»“åº“å

**Tag è¿‡æ»¤è§„åˆ™**
- **åŒ…å« Tagï¼ˆæ­£åˆ™ï¼‰**ï¼šåŒ¹é…è¦åŒæ­¥çš„ Tag
  - ç¤ºä¾‹ï¼š`^1\.2[0-9]\..*` åŒ¹é… 1.2x ç‰ˆæœ¬
  - å¤šä¸ªè§„åˆ™ç”¨é€—å·åˆ†éš”
  - ç•™ç©ºï¼šåŒæ­¥æ‰€æœ‰ Tag
- **æ’é™¤ Tagï¼ˆæ­£åˆ™ï¼‰**ï¼šæ’é™¤ä¸éœ€è¦çš„ Tag
  - ç¤ºä¾‹ï¼š`.*-alpine,.*-debug` æ’é™¤ alpine å’Œ debug ç‰ˆæœ¬
- **ä¿ç•™æœ€æ–° N ä¸ª**ï¼šåªåŒæ­¥æœ€æ–°çš„ N ä¸ª Tag
  - 0 è¡¨ç¤ºä¸é™åˆ¶

**æ¶æ„é€‰æ‹©**
- å¤šé€‰ï¼šamd64ã€arm64ã€arm/v7ã€386
- ç•™ç©ºï¼šåŒæ­¥æ‰€æœ‰æ¶æ„

**å®šæ—¶ä»»åŠ¡è®¾ç½®**
- ä¸å¯ç”¨å®šæ—¶ä»»åŠ¡ï¼šæ‰‹åŠ¨æ‰§è¡Œ
- æ¯å°æ—¶æ‰§è¡Œï¼š`0 * * * *`
- æ¯å¤©å‡Œæ™¨2ç‚¹ï¼š`0 2 * * *`
- æ¯å¤©ä¸­åˆ12ç‚¹ï¼š`0 12 * * *`
- æ¯å‘¨ä¸€å‡Œæ™¨2ç‚¹ï¼š`0 2 * * 1`
- æ¯æœˆ1å·å‡Œæ™¨2ç‚¹ï¼š`0 2 1 * *`
- æ¯6å°æ—¶æ‰§è¡Œï¼š`0 */6 * * *`
- æ¯12å°æ—¶æ‰§è¡Œï¼š`0 */12 * * *`
- è‡ªå®šä¹‰ï¼šæ‰‹åŠ¨è¾“å…¥ Cron è¡¨è¾¾å¼

**é€šçŸ¥é…ç½®**
- **å¯ç”¨é€šçŸ¥**ï¼šå¼€å…³
- **é€šçŸ¥æ¡ä»¶**ï¼š
  - å…¨éƒ¨å‘é€ï¼ˆæˆåŠŸ+å¤±è´¥ï¼‰
  - ä»…å¤±è´¥æ—¶å‘é€
- **é€šçŸ¥æ¸ é“**ï¼šé€‰æ‹©å·²é…ç½®çš„é€šçŸ¥æ¸ é“ï¼ˆå¯å¤šé€‰ï¼‰
- **å®šæ—¶ä»»åŠ¡æç¤º**ï¼šé¢‘ç¹æ‰§è¡Œçš„ä»»åŠ¡ä¼šäº§ç”Ÿå¤§é‡é€šçŸ¥

4. ç‚¹å‡» **ç¡®å®š** åˆ›å»ºä»»åŠ¡

### 3. æ‰§è¡Œä»»åŠ¡

**æ‰‹åŠ¨æ‰§è¡Œ**
1. åœ¨ä»»åŠ¡åˆ—è¡¨æ‰¾åˆ°ç›®æ ‡ä»»åŠ¡
2. ç‚¹å‡» **ç«‹å³è¿è¡Œ** æŒ‰é’®
3. è·³è½¬åˆ°æ‰§è¡Œå†å²é¡µé¢æŸ¥çœ‹è¿›åº¦

**åœæ­¢æ‰§è¡Œ**
1. åœ¨ä»»åŠ¡åˆ—è¡¨æˆ–æ‰§è¡Œå†å²é¡µé¢
2. ç‚¹å‡» **åœæ­¢** æŒ‰é’®ï¼ˆåªèƒ½åœæ­¢è¿è¡Œä¸­çš„ä»»åŠ¡ï¼‰

**æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—**
1. ç‚¹å‡»å·¦ä¾§èœå• **æ‰§è¡Œå†å²**
2. ç‚¹å‡»ä»»åŠ¡çš„ **æŸ¥çœ‹æ—¥å¿—** æŒ‰é’®
3. å®æ—¶æŸ¥çœ‹åŒæ­¥è¿›åº¦å’Œè¯¦ç»†æ—¥å¿—

### 4. é€šçŸ¥é…ç½®

**æ·»åŠ ä¼ä¸šå¾®ä¿¡é€šçŸ¥**
1. åœ¨ä¼ä¸šå¾®ä¿¡ä¸­åˆ›å»ºç¾¤æœºå™¨äºº
2. è·å– Webhook URL
3. åœ¨ç³»ç»Ÿä¸­ç‚¹å‡» **é€šçŸ¥ç®¡ç†** â†’ **æ·»åŠ é€šçŸ¥æ¸ é“**
4. å¡«å†™ï¼š
   - åç§°ï¼šä¼ä¸šå¾®ä¿¡-è¿ç»´ç¾¤
   - ç±»å‹ï¼šä¼ä¸šå¾®ä¿¡
   - Webhook URLï¼šç²˜è´´è·å–çš„ URL
   - å¯ç”¨ï¼šæ˜¯
5. ç‚¹å‡» **æµ‹è¯•å‘é€** éªŒè¯é…ç½®
6. ç‚¹å‡» **ç¡®å®š** ä¿å­˜

**æ·»åŠ é’‰é’‰é€šçŸ¥**
1. åœ¨é’‰é’‰ç¾¤ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äºº
2. è·å– Webhook URLï¼ˆå¯é€‰ï¼šåŠ ç­¾å¯†é’¥ï¼‰
3. åœ¨ç³»ç»Ÿä¸­æ·»åŠ é€šçŸ¥æ¸ é“
4. ç±»å‹é€‰æ‹© **é’‰é’‰**
5. å¡«å†™ Webhook URL
6. æµ‹è¯•å¹¶ä¿å­˜

**é€šçŸ¥æ¶ˆæ¯æ ¼å¼**
```
### é•œåƒåŒæ­¥ä»»åŠ¡é€šçŸ¥

> ä»»åŠ¡åç§°ï¼šåŒæ­¥ Nginx
> æ‰§è¡ŒçŠ¶æ€ï¼šæˆåŠŸ / å¤±è´¥
> æ‰§è¡Œè€—æ—¶ï¼š2åˆ†30ç§’
>
> æ•°æ®ç»Ÿè®¡
> - æ€»è®¡ï¼š16 ä¸ª blob
> - æˆåŠŸï¼š16 ä¸ª
> - è·³è¿‡ï¼š0 ä¸ª

2025-11-27 18:00:00
```

### 5. é«˜çº§åŠŸèƒ½

**Tag è¿‡æ»¤ç¤ºä¾‹**

```bash
# åªåŒæ­¥ latest å’Œ stable æ ‡ç­¾
åŒ…å«ï¼š^(latest|stable)$

# åŒæ­¥æ‰€æœ‰ 1.x ç‰ˆæœ¬
åŒ…å«ï¼š^1\..*

# æ’é™¤æ‰€æœ‰ beta å’Œ rc ç‰ˆæœ¬
æ’é™¤ï¼š.*(beta|rc).*

# åªåŒæ­¥æœ€æ–° 10 ä¸ªç‰ˆæœ¬
ä¿ç•™æœ€æ–°ï¼š10
```

**å¤šæ¶æ„é•œåƒåŒæ­¥**

ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¤šæ¶æ„é•œåƒï¼ˆManifest Listï¼‰ï¼Œå¹¶åŒæ­¥æ‰€æœ‰é€‰ä¸­çš„æ¶æ„ï¼š
1. æ£€æµ‹åˆ° Manifest List æ—¶ä¼šåœ¨æ—¥å¿—ä¸­æç¤º
2. ä¾æ¬¡åŒæ­¥æ¯ä¸ªæ¶æ„çš„ manifest å’Œ blobs
3. åªæœ‰æ‰€æœ‰æ¶æ„éƒ½æˆåŠŸåæ‰ä¸Šä¼  Manifest List

**æ•´ä¸ªé¡¹ç›®åŒæ­¥**

ä¸å¡«å†™æºä»“åº“åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åˆ—å‡ºé¡¹ç›®ä¸‹çš„æ‰€æœ‰ä»“åº“
2. å¯¹æ¯ä¸ªä»“åº“åº”ç”¨ Tag è¿‡æ»¤è§„åˆ™
3. ä¾æ¬¡åŒæ­¥åˆ°ç›®æ ‡é¡¹ç›®

---

## ğŸ“¡ API æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8080/api/v1`
- **è®¤è¯**: å½“å‰ç‰ˆæœ¬æ— éœ€è®¤è¯
- **Content-Type**: `application/json`

### Registry ç®¡ç†

```bash
# åˆ›å»º Registry
POST /api/v1/registries
{
  "name": "Harbor Prod",
  "url": "https://harbor.example.com",
  "username": "admin",
  "password": "password",
  "enabled": true
}

# åˆ—å‡ºæ‰€æœ‰ Registry
GET /api/v1/registries

# è·å–å•ä¸ª Registry
GET /api/v1/registries/:id

# æ›´æ–° Registry
PUT /api/v1/registries/:id

# åˆ é™¤ Registry
DELETE /api/v1/registries/:id

# æµ‹è¯•è¿æ¥
POST /api/v1/registries/:id/test

# åˆ—å‡ºé¡¹ç›®
GET /api/v1/registries/:id/projects

# åˆ—å‡ºä»“åº“
GET /api/v1/registries/:id/projects/:project/repositories
```

### ä»»åŠ¡ç®¡ç†

```bash
# åˆ›å»ºä»»åŠ¡
POST /api/v1/tasks

# åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
GET /api/v1/tasks

# è·å–ä»»åŠ¡è¯¦æƒ…
GET /api/v1/tasks/:id

# æ›´æ–°ä»»åŠ¡
PUT /api/v1/tasks/:id

# åˆ é™¤ä»»åŠ¡
DELETE /api/v1/tasks/:id

# ç«‹å³è¿è¡Œ
POST /api/v1/tasks/:id/run

# åœæ­¢ä»»åŠ¡
POST /api/v1/tasks/:id/stop
```

### æ‰§è¡Œå†å²

```bash
# åˆ—å‡ºæ‰§è¡Œè®°å½•
GET /api/v1/executions?limit=20&offset=0

# è·å–æ‰§è¡Œè¯¦æƒ…
GET /api/v1/executions/:id

# è·å–æ‰§è¡Œæ—¥å¿—
GET /api/v1/executions/:id/logs

# ç»Ÿè®¡ä¿¡æ¯
GET /api/v1/stats
```

### é€šçŸ¥ç®¡ç†

```bash
# åˆ›å»ºé€šçŸ¥æ¸ é“
POST /api/v1/notifications

# åˆ—å‡ºæ‰€æœ‰æ¸ é“
GET /api/v1/notifications

# æ›´æ–°æ¸ é“
PUT /api/v1/notifications/:id

# åˆ é™¤æ¸ é“
DELETE /api/v1/notifications/:id

# æµ‹è¯•å‘é€
POST /api/v1/notifications/:id/test
```

### WebSocket

```bash
# è¿æ¥ WebSocketï¼ˆå®æ—¶è¿›åº¦ï¼‰
WS /api/v1/ws

# æ¶ˆæ¯æ ¼å¼
{
  "type": "progress",
  "execution_id": 1,
  "data": {
    "total_blobs": 100,
    "synced_blobs": 50,
    "progress": 50.0
  }
}
```

### å¥åº·æ£€æŸ¥

```bash
# å¥åº·æ£€æŸ¥
GET /api/v1/health

# å“åº”
{
  "status": "ok",
  "version": "1.0.0"
}
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **è¯­è¨€**: Go 1.25+
- **æ¡†æ¶**: Gin (HTTP Router)
- **æ•°æ®åº“**: SQLite + GORM
- **è°ƒåº¦**: robfig/cron (Cron è¡¨è¾¾å¼)
- **WebSocket**: gorilla/websocket
- **HTTP**: net/http

### å‰ç«¯
- **æ¡†æ¶**: React 18 + TypeScript
- **UI åº“**: Ant Design 5
- **æ„å»ºå·¥å…·**: Vite 5
- **HTTP å®¢æˆ·ç«¯**: Axios
- **è·¯ç”±**: React Router 6
- **çŠ¶æ€ç®¡ç†**: React Hooks

### åŸºç¡€è®¾æ–½
- **å®¹å™¨**: Docker + Docker Compose
- **ç¼–æ’**: Kubernetes
- **å­˜å‚¨**: SQLiteï¼ˆæŒä¹…åŒ–å·ï¼‰
- **å¥åº·æ£€æŸ¥**: HTTP + WebSocket

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
registry-sync/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/main.go              # Web æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ internal/                       # å†…éƒ¨åŒ…ï¼ˆWeb æœåŠ¡ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ api/handlers/               # REST API å¤„ç†å™¨
â”‚   â”œâ”€â”€ api/middleware/             # ä¸­é—´ä»¶ï¼ˆCORS ç­‰ï¼‰
â”‚   â”œâ”€â”€ db/models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ db/store/                   # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ scheduler/                  # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â””â”€â”€ websocket/                  # WebSocket Hub
â”œâ”€â”€ pkg/                           # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ registry/                  # Registry API V2 å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ filter/                    # Tag è¿‡æ»¤å™¨
â”‚   â””â”€â”€ notification/              # é€šçŸ¥å‘é€
â”œâ”€â”€ web/                           # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                   # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ components/            # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ types/                 # TypeScript ç±»å‹
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ k8s/                           # Kubernetes éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ namespace.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â”œâ”€â”€ pvc.yaml
â”‚   â””â”€â”€ kustomization.yaml
â”œâ”€â”€ Dockerfile                     # Docker é•œåƒæ„å»º
â”œâ”€â”€ docker-compose.yml             # Docker Compose é…ç½®
â”œâ”€â”€ .github/workflows/             # GitHub Actions CI/CD
â”‚   â””â”€â”€ docker-build.yml
â””â”€â”€ README.md
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šè·¨äº‘è¿ç§»
**éœ€æ±‚**: ä» Docker Hub è¿ç§»é•œåƒåˆ°é˜¿é‡Œäº‘ ACR

**é…ç½®**:
- æº Registry: Docker Hub
- ç›®æ ‡ Registry: é˜¿é‡Œäº‘ ACR
- Tag è¿‡æ»¤: åªåŒæ­¥ stable å’Œ latest
- æ¶æ„: amd64 + arm64

### åœºæ™¯ 2ï¼šå†…ç½‘é•œåƒåŒæ­¥
**éœ€æ±‚**: ä»å…¬ç½‘ Harbor åŒæ­¥åˆ°å†…ç½‘ Harbor

**é…ç½®**:
- æº Registry: å…¬ç½‘ Harbor
- ç›®æ ‡ Registry: å†…ç½‘ Harbor
- å®šæ—¶ä»»åŠ¡: æ¯å¤©å‡Œæ™¨ 2 ç‚¹
- é€šçŸ¥: å¤±è´¥æ—¶å‘é€é’‰é’‰é€šçŸ¥

### åœºæ™¯ 3ï¼šç¾å¤‡åŒæ­¥
**éœ€æ±‚**: ç”Ÿäº§é•œåƒå®šæœŸå¤‡ä»½åˆ°å¤‡ç”¨ Registry

**é…ç½®**:
- æº Registry: ç”Ÿäº§ Harbor
- ç›®æ ‡ Registry: å¤‡ä»½ Harbor
- å®šæ—¶ä»»åŠ¡: æ¯ 12 å°æ—¶æ‰§è¡Œ
- ä¿ç•™: æœ€æ–° 10 ä¸ªç‰ˆæœ¬

### åœºæ™¯ 4ï¼šå¤šæ¶æ„é•œåƒåˆ†å‘
**éœ€æ±‚**: åŒæ­¥å¤šæ¶æ„é•œåƒåˆ°å¤šä¸ªåŒºåŸŸ

**é…ç½®**:
- æº Registry: Docker Hub
- ç›®æ ‡ Registry: å„åŒºåŸŸ Harbor
- æ¶æ„é€‰æ‹©: amd64, arm64, arm/v7
- è¿‡æ»¤: æ’é™¤ debug å’Œ alpine ç‰ˆæœ¬

---

## â“ å¸¸è§é—®é¢˜

### Q1: Docker Hub æ‹‰å–å¤±è´¥ï¼ŒæŠ¥ 429 é”™è¯¯ï¼Ÿ
**A**: Docker Hub æœ‰é™æµé™åˆ¶ï¼ˆå…è´¹ç”¨æˆ· 100æ¬¡/6å°æ—¶ï¼‰
- è§£å†³æ–¹æ¡ˆ 1: ä½¿ç”¨ Docker Hub ç™»å½•å‡­æ®
- è§£å†³æ–¹æ¡ˆ 2: é”™å³°æ‰§è¡Œï¼Œé¿å¼€é«˜å³°æœŸ
- è§£å†³æ–¹æ¡ˆ 3: è€ƒè™‘å‡çº§ Docker Hub è´¦æˆ·

### Q2: Harbor é¡¹ç›®ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ
**A**: ç³»ç»Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºé¡¹ç›®
- æ‰‹åŠ¨åœ¨ Harbor ä¸­åˆ›å»ºç›®æ ‡é¡¹ç›®
- æˆ–åœ¨ä»»åŠ¡é…ç½®ä¸­ä½¿ç”¨å·²å­˜åœ¨çš„é¡¹ç›®

### Q3: å¤šæ¶æ„é•œåƒåŒæ­¥å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æºé•œåƒæ˜¯å¦çœŸçš„æ˜¯å¤šæ¶æ„ï¼ˆManifest Listï¼‰
- ç›®æ ‡ Registry æ˜¯å¦æ”¯æŒ Manifest List
- ç½‘ç»œæ˜¯å¦ç¨³å®šï¼Œæ˜¯å¦æœ‰è¶…æ—¶

### Q4: å®šæ—¶ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œï¼Ÿ
**A**: æ£€æŸ¥ï¼š
- ä»»åŠ¡æ˜¯å¦å·²å¯ç”¨
- Cron è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ‰§è¡Œå†å²æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
- é‡å¯æœåŠ¡å Cron ä¼šé‡æ–°åŠ è½½

### Q5: WebSocket è¿æ¥å¤±è´¥ï¼Ÿ
**A**:
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…è®¸ WebSocket
- å¦‚æœä½¿ç”¨åå‘ä»£ç†ï¼Œéœ€è¦é…ç½® WebSocket æ”¯æŒ
- Nginx ç¤ºä¾‹ï¼š`proxy_set_header Upgrade $http_upgrade;`

### Q6: å¦‚ä½•åŠ é€ŸåŒæ­¥ï¼Ÿ
**A**:
- ç¡®ä¿ç½‘ç»œå¸¦å®½å……è¶³
- æºå’Œç›®æ ‡ Registry ç½‘ç»œå»¶è¿Ÿä½
- å¤§å¤šæ•°æƒ…å†µä¸‹ç“¶é¢ˆåœ¨ç½‘ç»œï¼Œè€Œéç³»ç»Ÿ

### Q7: å¯†ç ä¼šæ³„éœ²å—ï¼Ÿ
**A**:
- å¯†ç å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ï¼ˆæ˜æ–‡ï¼‰
- å»ºè®®ï¼š
  - é™åˆ¶æ•°æ®åº“æ–‡ä»¶è®¿é—®æƒé™
  - ä½¿ç”¨ä¸“ç”¨çš„åŒæ­¥è´¦æˆ·
  - å®šæœŸè½®æ¢å¯†ç 
  - åç»­ç‰ˆæœ¬ä¼šæ”¯æŒåŠ å¯†å­˜å‚¨

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **æœ€å°æƒé™åŸåˆ™**
   - ä¸ºåŒæ­¥ä»»åŠ¡åˆ›å»ºä¸“ç”¨è´¦æˆ·
   - åªæˆäºˆå¿…è¦çš„ä»“åº“æƒé™ï¼ˆè¯»/å†™ï¼‰

2. **ç½‘ç»œéš”ç¦»**
   - åœ¨å†…ç½‘ç¯å¢ƒéƒ¨ç½²æ—¶ä½¿ç”¨é˜²ç«å¢™
   - é™åˆ¶åªæœ‰å¿…è¦çš„æœåŠ¡å™¨å¯ä»¥è®¿é—®

3. **æ•°æ®ä¿æŠ¤**
   - å®šæœŸå¤‡ä»½ SQLite æ•°æ®åº“
   - é™åˆ¶æ•°æ®åº“æ–‡ä»¶è®¿é—®æƒé™ï¼ˆchmod 600ï¼‰

4. **å¯†ç ç®¡ç†**
   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸè½®æ¢å¯†ç 
   - ä¸è¦åœ¨æ—¥å¿—ä¸­æš´éœ²å¯†ç 

5. **HTTPS**
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS
   - é…ç½® Ingress TLS è¯ä¹¦

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### èµ„æºæ¶ˆè€—
- **å†…å­˜**: 128-256MBï¼ˆç©ºé—²ï¼‰/ 256-512MBï¼ˆåŒæ­¥ä¸­ï¼‰
- **CPU**: 0.1-0.5 æ ¸ï¼ˆç©ºé—²ï¼‰/ 0.5-2 æ ¸ï¼ˆåŒæ­¥ä¸­ï¼‰
- **ç£ç›˜**: ä»…å­˜å‚¨æ•°æ®åº“ï¼Œä¸ç¼“å­˜é•œåƒ
- **ç½‘ç»œ**: å–å†³äºé•œåƒå¤§å°å’Œå¹¶å‘æ•°

### åŒæ­¥é€Ÿåº¦
- **å°é•œåƒ** (< 100MB): 1-3 åˆ†é’Ÿ
- **ä¸­ç­‰é•œåƒ** (100MB-1GB): 3-10 åˆ†é’Ÿ
- **å¤§é•œåƒ** (> 1GB): 10+ åˆ†é’Ÿ

*å®é™…é€Ÿåº¦å–å†³äºç½‘ç»œå¸¦å®½å’Œ Registry æ€§èƒ½*

### å¹¶å‘èƒ½åŠ›
- **å•ä»»åŠ¡**: è‡ªåŠ¨å¹¶å‘ä¼ è¾“å¤šä¸ª Blob
- **å¤šä»»åŠ¡**: æ”¯æŒå¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œ
- **WebSocket**: æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥

---

## ğŸ—ºï¸ Roadmap

### v0.1.0ï¼ˆè®¡åˆ’ä¸­ï¼‰
- [ ] ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- [ ] æ›´å¤šé€šçŸ¥æ¸ é“ï¼ˆé‚®ä»¶ã€Slackï¼‰
- [ ] æ•°æ®åº“å¯†ç åŠ å¯†
- [ ] ä»»åŠ¡æ‰§è¡Œå†å²ä¿ç•™ç­–ç•¥
- [ ] Prometheus metrics

### v0.2.0ï¼ˆè§„åˆ’ä¸­ï¼‰
- [ ] ä»»åŠ¡åˆ›å»ºå‘å¯¼
- [ ] æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡æš‚åœ/å¯åŠ¨/åˆ é™¤ï¼‰
- [ ] é•œåƒæ‰«æé›†æˆ
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆEnglishï¼‰
- [ ] Swagger API æ–‡æ¡£

### v0.3.0ï¼ˆè§„åˆ’ä¸­ï¼‰
- [ ] åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- [ ] Redis ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—
- [ ] é«˜å¯ç”¨æ¶æ„
- [ ] æ€§èƒ½ç›‘æ§é¢æ¿

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

**å¼€å‘æµç¨‹**:
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

**å¼€å‘è§„èŒƒ**:
- Go ä»£ç éµå¾ª `gofmt` æ ¼å¼
- å‰ç«¯ä»£ç éµå¾ª ESLint è§„åˆ™
- æäº¤ä¿¡æ¯ä½¿ç”¨è‹±æ–‡ï¼Œéµå¾ª Conventional Commits
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [Gin](https://github.com/gin-gonic/gin) - HTTP æ¡†æ¶
- [GORM](https://gorm.io/) - ORM åº“
- [Ant Design](https://ant.design/) - React UI ç»„ä»¶åº“
- [React](https://react.dev/) - å‰ç«¯æ¡†æ¶
- [Vite](https://vitejs.dev/) - æ„å»ºå·¥å…·

---

## ğŸ“ è”ç³»æ–¹å¼

- **Issues**: https://github.com/yunzck8s/registry-sync/issues
- **Discussions**: https://github.com/yunzck8s/registry-sync/discussions

---

<div align="center">

**Made with â¤ï¸ for DevOps Engineers**

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼

</div>
